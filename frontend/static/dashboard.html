<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Ryde</title>
    <link rel="stylesheet" href="/static/css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <h1>Ryde</h1>
      <div>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </header>

    <div class="dashboard-container">
      <div class="map-container">
        <div id="map"></div>
      </div>

      <div class="action-buttons">
        <button class="btn big primary" onclick="startBooking('repair')">
          Book Repair
        </button>
        <button class="btn big danger" onclick="startBooking('towing')">
          Book Towing
        </button>
      </div>
    </div>

    <!-- Google Maps -->
    <script>
      let map, userMarker;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 22.57, lng: 88.36 }, // Default: example location (Kolkata area)
          zoom: 12,
        });
        getUserLocation();
      }

      function getUserLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const lat = position.coords.latitude;
              const lng = position.coords.longitude;

              if (userMarker) userMarker.setMap(null);
              userMarker = new google.maps.Marker({
                position: { lat, lng },
                map,
                title: "Your Location",
                icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
              });

              map.setCenter({ lat, lng });
              map.setZoom(14);

              // You can call loadNearbyProviders(lat, lng) here later
            },
            () =>
              alert(
                "Could not get your location. Please allow location access.",
              ),
            { enableHighAccuracy: true },
          );
        } else {
          alert("Geolocation is not supported by your browser.");
        }
      }

      function startBooking(type) {
        alert(
          `Starting ${type} booking flow...\n\n(Implementation coming next)`,
        );
        // → Next step: show form/modal → send to /bookings/
      }
    </script>

    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY_HERE&callback=initMap"
    ></script>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/auth.js"></script>
  </body>
</html>
